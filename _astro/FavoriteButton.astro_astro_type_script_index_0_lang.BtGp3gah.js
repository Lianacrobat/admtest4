import{s as i}from"./telegram.Ce-bSytT.js";const s=()=>{try{return JSON.parse(localStorage.getItem("favorites")||"[]")}catch{return[]}},c=t=>{try{localStorage.setItem("favorites",JSON.stringify(t))}catch(e){console.error("Error saving favorites:",e)}},l=(t,e)=>{e?(t.classList.add("fill-red-500","text-red-500"),t.classList.remove("fill-none","text-[var(--text-color-soft)]")):(t.classList.remove("fill-red-500","text-red-500"),t.classList.add("fill-none","text-[var(--text-color-soft)]"))},u=(t,e)=>{document.querySelectorAll(`.favorite-btn[data-product-id="${t}"] .heart-icon`).forEach(o=>l(o,e))},f=async(t,e)=>{const o=s();if(o.includes(t)){const r=o.filter(v=>v!==t);return c(r),i(e,"removed").catch(console.warn),!1}else return o.push(t),c(o),i(e,"added").catch(console.warn),!0},d=async t=>{t.preventDefault(),t.stopPropagation();const e=t.currentTarget,o=e.dataset.productId,a=e.dataset.productName;if(!e.disabled){e.disabled=!0;try{const r=await f(o,a);u(o,r),window.dispatchEvent(new CustomEvent("favoritesChanged",{detail:{productId:o,isFavorite:r,productName:a}})),window.updateFavoritesCount&&window.updateFavoritesCount(s().length)}catch(r){console.error("Error toggling favorite:",r)}finally{e.disabled=!1}}},n=()=>{document.querySelectorAll(".favorite-btn").forEach(t=>{const e=t.dataset.productId,o=s().includes(e),a=t.querySelector(".heart-icon");l(a,o),t.removeEventListener("click",d),t.addEventListener("click",d)})};document.addEventListener("DOMContentLoaded",n);document.addEventListener("astro:page-load",n);document.addEventListener("favoritesChanged",()=>{setTimeout(n,50)});
